(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["admin/app"];var a=e.n(t);const n=flarum.core.compat.Model;var i=e.n(n);const s=flarum.core.compat["models/User"];var o=e.n(s);function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}flarum.core.compat["utils/mixin"];var c=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(i());Object.assign(c.prototype,{id:i().attribute("id"),name:i().attribute("name"),description:i().attribute("description"),computation:i().attribute("computation"),points:i().attribute("points"),rectangle:i().attribute("rectangle"),image:i().attribute("image"),new:i().attribute("new"),active:i().attribute("active"),hidden:i().attribute("hidden")});var h=function(e){function t(){return e.apply(this,arguments)||this}return r(t,e),t}(i());Object.assign(h.prototype,{achievement_id:i().attribute("achievement_id"),user_id:i().attribute("user_id"),new:i().attribute("new")});const d=flarum.core.compat["components/ExtensionPage"];var p=e.n(d);const u=flarum.core.compat["components/LoadingIndicator"];var v=e.n(u);const g=flarum.core.compat["helpers/icon"];var b=e.n(g);const f=flarum.core.compat["components/Modal"];var _=e.n(f);const y=flarum.core.compat["components/Button"];var N=e.n(y);const w=flarum.core.compat["components/Checkbox"];var F=e.n(w);const x=flarum.core.compat["components/Tooltip"];var I=e.n(x);const A=flarum.core.compat["utils/ItemList"];var k=e.n(A);const M=flarum.core.compat["utils/Stream"];var C=e.n(M);const E=flarum.core.compat["common/Component"];var P=e.n(E);const j=flarum.core.compat["components/Dropdown"];var B=e.n(j),D=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t)},n.oncreate=function(t){e.prototype.oncreate.call(this,t)},n.view=function(){var e=this,t=a().translator.trans("malago-achievements.admin.achievement_modal.variable."+this.attrs.id());return m("span",null,m(B(),{label:t,buttonClassName:"Button Button--danger"},["manual","posts","likes","selflikes","discussions","edits","avatar","comments","contains","meanwords","tagposts","years"].map((function(t){return N().component({active:e.attrs.id(),onclick:function(){e.attrs.id(t),"avatar"===t||"manual"===t?$(".FormInline").addClass("FormHidden"):($(".FormInline").removeClass("FormHidden"),$("input.FormInline").attr("data-original-title",a().translator.trans("malago-achievements.admin.achievement_modal.tooltip."+t)))}},a().translator.trans("malago-achievements.admin.achievement_modal.variable."+t))}))))},t}(P()),L=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var a=t.prototype;return a.oninit=function(t){if(e.prototype.oninit.call(this,t),this.achievement=this.attrs.model||app.store.createRecord("achievements"),this.id=C()(this.achievement.data.id||"-"),this.name=C()(this.achievement.name()||""),this.description=C()(this.achievement.description()||""),this.achievement.computation()){var a=this.achievement.computation().split(":");this.selected_variable=C()(a[0]),this.computation=C()(a[1]),"avatar"!=this.selected_variable()&&"manual"!=this.selected_variable()||$(".FormInline").hide()}else this.computation=C()(""),this.selected_variable=C()("manual");if(this.points=C()(this.achievement.points()||""),this.image=C()(this.achievement.image()||""),this.active=C()(this.achievement.active()||1),this.hidden=C()(this.achievement.hidden()||0),this.achievement.rectangle()){var n=this.achievement.rectangle().split(",");this.row=C()(n[0]/n[2]+1),this.col=C()(n[1]/n[3]+1),this.width=C()(n[3]),this.height=C()(n[2])}else this.row=C()("1"),this.col=C()("1"),this.width=C()(""),this.height=C()("")},a.className=function(){return"EditAchievementModal Modal--large"},a.title=function(){return this.name()?this.name()+" ID: "+this.id():app.translator.trans("malago-achievements.admin.achievement_modal.title")},a.content=function(){if(this.loading)return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"container"},m(v(),null))));var e=this.fields().toArray();return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"ModalColumn"},e.slice(0,6)),m("div",{className:"ModalColumn"},e.slice(6))))},a.fields=function(){var e=this,t=new(k());return t.add("name",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.name_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("malago-achievements.admin.achievement_modal.name_placeholder"),bidi:this.name})),50),t.add("active",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.active_label")),F().component({state:this.active(),onchange:function(){e.active((e.active()+1)%2)}})),50),t.add("hidden",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.hidden_label")),F().component({state:this.hidden(),onchange:function(){e.hidden((e.hidden()+1)%2)}})),50),t.add("description",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.description_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("malago-achievements.admin.achievement_modal.description_placeholder"),bidi:this.description})),50),t.add("computation",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.variable_label")),m(D,{label:app.translator.trans("malago-achievements.admin.achievement_modal.variable_label"),id:this.selected_variable}),m(I(),{id:"Tooltip-computation",text:""},m("input",{className:"avatar"==this.selected_variable()||"manual"==this.selected_variable()?"FormControl FormHidden FormInline":"FormControl FormInline",placeholder:app.translator.trans("malago-achievements.admin.achievement_modal.computation_placeholder"),bidi:this.computation}))),50),t.add("points",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.points_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("malago-achievements.admin.achievement_modal.points_placeholder"),bidi:this.points})),50),t.add("image",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.image_label")),m("input",{className:"FormControl",placeholder:app.translator.trans("malago-achievements.admin.achievement_modal.image_placeholder"),bidi:this.image,onchange:this.showImage()})),50),t.add("image-show",m("div",{className:"Form-group"},m("div",{class:"AchievementImage-Show"},"Â ")),50),t.add("size",m("div",{className:"Form-group Image-data"},m("table",{className:"AchievementModal-Table"},m("tr",null,m("td",null,m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.height_label"))),m("td",null,m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.width_label")))),m("tr",null,m("td",null,m("input",{className:"FormControl",bidi:this.height,onchange:this.showImage(),type:"number"})),m("td",null,m("input",{className:"FormControl",bidi:this.width,onchange:this.showImage(),type:"number"}))))),50),t.add("position",m("div",{className:"Form-group Image-data"},m("table",{className:"AchievementModal-Table"},m("tr",null,m("td",null,m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.row_label"))),m("td",null,m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.col_label")))),m("tr",null,m("td",null,m("input",{className:"FormControl",placeholder:1,bidi:this.col,onchange:this.showImage(),type:"number"})),m("td",null,m("input",{className:"FormControl",placeholder:1,bidi:this.row,onchange:this.showImage(),type:"number"}))))),50),t.add("submit",m("div",{className:"Form-group"},N().component({type:"submit",className:"Button Button--primary EditAchievementModal-save",loading:this.loading,disabled:0===this.name().length},app.translator.trans("malago-achievements.admin.achievement_modal.submit_button")),this.achievement.exists?m("button",{type:"button",className:"Button EditAchievementsModal-delete",onclick:this.delete.bind(this)},app.translator.trans("malago-achievements.admin.achievement_modal.delete_button")):""),-10),t},a.showImage=function(){var e=this.image(),t=document.querySelector(".AchievementImage-Show"),a=document.querySelector(".Image-data");t&&a&&(e.includes("http")?(t.innerHTML="",a.style.display="block",t.style.backgroundSize="cover",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="-"+(this.row()-1)*this.height()+"px -"+(this.col()-1)*this.width()+"px",t.style.backgroundImage="url("+e+")",t.style.width=this.width()+"px",t.style.height=this.height()+"px"):(t.innerHTML="<i class='icon "+e+"'></i>",t.style.background="none",t.style.height="32px",t.style.width="32px",a.style.display="none"))},a.submitData=function(){return{name:this.name(),description:this.description(),computation:this.selected_variable()+":"+this.computation(),points:this.points(),image:this.image(),rectangle:[(this.row()-1)*this.height(),(this.col()-1)*this.width(),this.height(),this.width()].join(","),active:this.active(),hidden:this.hidden()}},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,this.achievement.save(this.submitData()).then((function(){return t.hide()}),(function(){return t.loading=!1}))},a.delete=function(){confirm(app.translator.trans("malago-achievements.admin.achievement_modal.delete_confirmation"))&&(this.achievement.delete().then((function(){m.redraw()})),this.hide())},t}(_()),O=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.achievement=this.attrs.model,this.achievement_user=app.store.createRecord("achievement_user"),this.name=C()(this.achievement.name()||""),this.id=C()(this.achievement.data.id||""),this.user_id=C()("")},a.className=function(){return"EditAchievementModal Modal--small"},a.title=function(){return this.name()?this.name():app.translator.trans("malago-achievements.admin.achievement_modal.add_delete_title")},a.content=function(){return this.loading?m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"container"},m(v(),null)))):m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray()))},a.fields=function(){var e=new(k());return e.add("instructions",m("div",{className:"Form-group"},m("p",null,app.translator.trans("malago-achievements.admin.achievement_modal.add_delete_instructions"))),50),e.add("user_id",m("div",{className:"Form-group"},m("label",null,app.translator.trans("malago-achievements.admin.achievement_modal.username")),m("input",{className:"FormControl",placeholder:app.translator.trans("malago-achievements.admin.achievement_modal.username_placeholder"),bidi:this.user_id})),50),e.add("submit",m("div",{className:"Form-group"},N().component({type:"submit",className:"Button Button--primary EditAchievementModal-save",loading:this.loading,disabled:0===this.name().length},app.translator.trans("malago-achievements.admin.achievement_modal.submit_button"))),-10),e},a.submitData=function(){return{id:this.id(),user_id:this.user_id(),new:1}},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,""!=this.user_id()&&this.achievement_user.save(this.submitData()).then((function(){return t.hide()}),(function(){return t.loading=!1}))},t}(_());const S=flarum.core.compat["utils/saveSettings"];var T=e.n(S);const H=flarum.core.compat["components/Switch"];var z=e.n(H);function R(e){var t=e?e.name():app.translator.trans("malago-achievements.admin.achievements_page.create_achievement_button"),a=(e?e.rectangle():"0,0,32,32").split(","),n=e?"":b()("fas fa-plus"),i=app.translator.trans("malago-achievements.admin.achievements_page.add_delete_users"),s="background:none;      height:32px;      width:32px;";return e&&(e.image().includes("http")?s="background:url("+e.image()+");      background-position:-"+a[0]+"px -"+a[1]+"px;      height:"+a[2]+"px;      width:"+a[3]+"px;":n=b()(e.image())),m("div",{className:"ExtensionListItem"},m("span",{className:"ExtensionListItem-icon ExtensionIcon Achievement",style:s,onclick:function(){return app.modal.show(L,{model:e})}},n),m("span",{className:"ExtensionListItem-title"},t),m("span",{className:"ExtensionListItem-user","data-toggle":"tooltip",title:i,onclick:function(){return e?app.modal.show(O,{model:e}):null}},m("i",{class:"fas fa-users-cog"})))}var q=function(e){function t(){return e.apply(this,arguments)||this}r(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t);var n=app.data.settings;this.values={},this.settingsPrefix="malago-achievements",this.settings=["show-post-footer","show-user-card","link-left-column"],this.settings.forEach((function(e){return a.values[e]=C()(Number(n[a.addPrefix(e)]))})),this.loading=!0,app.store.find("achievements").then((function(){a.loading=!1,m.redraw()}))},a.content=function(){return this.loading?m("div",{className:"Achievements"},m("div",{className:"container"},m(v(),null))):m("div",{className:"Achievements"},m("div",{className:"container"},m("div",{className:"ExtensionsWidget-list Achievements-list"},m("p",{className:"Achievements-list-heading"},app.translator.trans("malago-achievements.admin.achievements_page.list_heading")),m("div",{className:"ExtensionList AchievementListAdmin"},[].concat(app.store.all("achievements").map(R),[R()]))),m("p",{className:"Achievements-list-heading"},app.translator.trans("malago-achievements.admin.achievements_page.show")),m("form",{onsubmit:this.onsubmit.bind(this)},m("fieldset",{className:"Achievements-settings"},[z().component({state:this.values["show-post-footer"]()||!1,onchange:this.values["show-post-footer"]},app.translator.trans("malago-achievements.admin.settings.show-post-footer")),z().component({state:this.values["show-user-card"]()||!1,onchange:this.values["show-user-card"]},app.translator.trans("malago-achievements.admin.settings.show-user-card")),z().component({state:this.values["link-left-column"]()||!1,onchange:this.values["link-left-column"]},app.translator.trans("malago-achievements.admin.settings.link-left-column")),N().component({type:"submit",className:"Button Button--primary",disabled:!this.changed()},app.translator.trans("malago-achievements.admin.achievement_modal.submit_button"))])),m("div",{className:"Achievements-footer"},m("p",{className:"Achievements-list-heading"},app.translator.trans("malago-achievements.admin.achievements_page.instructions_header")),m("ul",null,app.translator.trans("malago-achievements.admin.achievements_page.instructions_text")))))},a.changed=function(){var e=this;return this.settings.some((function(t){return e.values[t]()!==app.data.settings[e.addPrefix(t)]}))},a.onsubmit=function(e){var t=this;if(e.preventDefault(),!this.loading){this.loading=!0,app.alerts.dismiss(this.successAlert);var a={};this.settings.forEach((function(e){return a[t.addPrefix(e)]=t.values[e]()})),T()(a).then((function(){app.alerts.show({type:"success"},app.translator.trans("core.admin.settings.saved_message"))})).catch((function(){})).then((function(){t.loading=!1}))}},a.addPrefix=function(e){return this.settingsPrefix+"."+e},t}(p());a().initializers.add("justoverclock/flachievements",(function(){a().extensionData.for("justoverclock-flachievements").registerPage(q),o().prototype.achievements=i().hasMany("achievements","achievement_user"),o().prototype.achievement_user=i().hasMany("achievement_user"),app.store.models.achievements=c,app.store.models.achievement_user=h}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map