(()=>{var e={787:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var a=n(588),i=n(921),s=n.n(i),o=(n(779),function(e){function t(){return e.apply(this,arguments)||this}return(0,a.A)(t,e),t}(s()));Object.assign(o.prototype,{id:s().attribute("id"),name:s().attribute("name"),description:s().attribute("description"),computation:s().attribute("computation"),points:s().attribute("points"),rectangle:s().attribute("rectangle"),image:s().attribute("image"),new:s().attribute("new"),active:s().attribute("active"),hidden:s().attribute("hidden")})},556:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var a=n(588),i=n(921),s=n.n(i),o=function(e){function t(){return e.apply(this,arguments)||this}return(0,a.A)(t,e),t}(s());Object.assign(o.prototype,{achievement_id:s().attribute("achievement_id"),user_id:s().attribute("user_id"),new:s().attribute("new")})},506:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var a=n(921),i=n.n(a),s=n(524),o=n.n(s),r=n(787),c=n(556);function m(){o().prototype.achievements=i().hasMany("achievements","achievement_user"),o().prototype.achievement_user=i().hasMany("achievement_user"),app.store.models.achievements=r.A,app.store.models.achievement_user=c.A}},921:e=>{"use strict";e.exports=flarum.core.compat.Model},524:e=>{"use strict";e.exports=flarum.core.compat["models/User"]},779:e=>{"use strict";e.exports=flarum.core.compat["utils/mixin"]},588:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var a=n(47);function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,a.A)(e,t)}},47:(e,t,n)=>{"use strict";function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}n.d(t,{A:()=>a})}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";const e=flarum.core.compat.extend,t=flarum.core.compat["components/CommentPost"];var a=n.n(t);const i=flarum.core.compat["common/Application"];var s=n.n(i),o=n(588);const r=flarum.core.compat.app;var c=n.n(r);const l=flarum.core.compat["helpers/icon"];var p=n.n(l);const u=flarum.core.compat["components/Modal"];var h=n.n(u);const d=flarum.core.compat["utils/ItemList"];var v=n.n(d);const f=flarum.core.compat["components/Button"];var g=n.n(f);const b=flarum.core.compat["common/components/LoadingIndicator"];var _=n.n(b),y=function(e){function t(){return e.apply(this,arguments)||this}(0,o.A)(t,e);var n=t.prototype;return n.title=function(){return c().translator.trans("malago-achievements.forum.new_achievement_title")},n.oninit=function(t){e.prototype.oninit.call(this,t)},n.fields=function(){var e=new(v());return this.attrs.achievements.forEach((function(t,n){var a=t.rectangle.split(",").map(Number),i=a[0],s=a[1],o=a[2],r=a[3];if(t.image.includes("http")){var c={backgroundImage:"url("+t.image+")",backgroundPosition:"-"+i+"px -"+s+"px",height:o+"px",width:r+"px"};e.add("image"+n,m("div",{className:"Form-group"},m("span",{className:"Badge Achievement",style:c})),-10)}else e.add("image"+n,m("div",{className:"Form-group"},m("span",{className:"Badge Achievement--Icon"},p()(t.image))),-10);e.add("name"+n,m("div",{className:"Form-group"},m("h1",null,t.name)),-10),e.add("description"+n,m("div",{className:"Form-group"},m("h3",null,t.description)),-10)})),e.add("close",m("div",{className:"NewAchievementModal--Button"},g().component({type:"button",className:"Button Button--primary",onclick:this.hide.bind(this)},c().translator.trans("malago-achievements.forum.new_achievement_close"))),-10),e},n.footer=function(){return null},n.content=function(){return this.loading?m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"container"},m(_(),null)))):m("div",{className:"Modal-body"},m("div",{className:"Modal--New-Achievement"},this.fields().toArray()))},t}(h());const A=flarum.core.compat["components/IndexPage"];var x=n.n(A);const N=flarum.core.compat["components/Page"];var w=n.n(N);const L=flarum.core.compat["common/components/Page"];var I=n.n(L);flarum.core.compat["components/Link"];const P=flarum.core.compat["components/LoadingIndicator"];var O=n.n(P);const k=flarum.core.compat["helpers/listItems"];var B=n.n(k);flarum.core.compat["helpers/humanTime"];const M=flarum.core.compat["components/Tooltip"];var j=n.n(M),T=function(e){function t(){return e.apply(this,arguments)||this}(0,o.A)(t,e);var n=t.prototype;return n.oninit=function(t){var n=this;this.loading=!0,e.prototype.oninit.call(this,t),app.session.user||m.route.set("/"),this.achievements_ids=[],app.data.resources.map((function(e){"achievement_user"==e.type&&n.achievements_ids.push(e.attributes.id)})),this.achievements_all=[],this.html_user="",this.html_all="",this.points=0,this.hidden_count=0,app.store.find("achievements").then((function(e){n.achievements_all=e,n.achievements_all.map((function(e){var t=e.rectangle().split(","),a="";a=e.image().includes("http")?'<li>              <div class="AchievementsList-Item">                <div class="Badge Achievement" style="background:url('+e.image()+");            background-position:-"+t[0]+"px -"+t[1]+"px;            height:"+t[2]+"px;            width:"+t[3]+'px;" data-toggle="tooltip" title='+e.name()+'></div>                  <table class="AchievementsList-info"><tr><td class="AchievementsList-name">'+e.name()+'</td><td class="AchievementsList-points">'+app.translator.trans("malago-achievements.forum.achievement_points")+": "+e.points()+'</td></tr></table>                  <div class="AchievementsList-description">'+e.description()+"</div>              </div>            </li>":'<li>              <div class="AchievementsList-Item">                <div class="Badge Achievement--Icon"><i class="icon '+e.image()+'"></i></div>                <table class="AchievementsList-info"><tr><td class="AchievementsList-name">'+e.name()+'</td><td class="AchievementsList-points">'+app.translator.trans("malago-achievements.forum.achievement_points")+": "+e.points()+'</td></tr></table>                <div class="AchievementsList-description">'+e.description()+"</div>              </div>            </li>",-1!==n.achievements_ids.indexOf(parseInt(e.data.id))?(n.html_user+=a,n.points+=parseFloat(e.points())):0==e.hidden()?n.html_all+=a:n.hidden_count+=1})),n.loading=!1,m.redraw()}))},n.view=function(){return this.loading?m(O(),null):m("div",{className:"IndexPage"},x().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,B()(x().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h2",null,app.translator.trans("malago-achievements.forum.your_achievements")),m("div",{className:"AchievementsList"},m("ul",{className:"AchievementsList-achievements"},m.trust(this.html_user),m("li",null,m("div",{class:"AchievementsList-Item"},m("div",{className:"AchievementsList-points AchievementsList-total",style:"color: black; border: 2px solid black;"},app.translator.trans("malago-achievements.forum.achievement_total_points")+": "+this.points))))),m("h2",null,app.translator.trans("malago-achievements.forum.other_achievements")),m("div",{className:"AchievementsList AchievementsList-Other"},m("ul",{className:"AchievementsList-achievements"},m.trust(this.html_all))),m("div",{className:"AchievementsHidden"},this.hidden_count>0?app.translator.trans("malago-achievements.forum.hidden_achievements")+": "+this.hidden_count:"")))))},n.oncreate=function(t){e.prototype.oncreate.call(this,t),app.setTitle(app.translator.trans("malago-achievements.forum.list_heading")),app.setTitleCount(0)},t}(I());const C=flarum.core.compat["components/LinkButton"];var F=n.n(C);const S=flarum.core.compat["components/UserCard"];var U=n.n(S),E=n(506).default;app.initializers.add("malago-achievements",(function(t){t.routes.achievements={path:"/achievements",component:T},(0,e.extend)(x().prototype,"navItems",(function(e){var n=t.forum.attribute("malago-achievements.link-left-column");t.session.user&&1===n&&e.add("achievements",m(F(),{icon:"fas fa-trophy",href:t.route("achievements")},t.translator.trans("malago-achievements.forum.list_heading")),-11)})),E(),(0,e.extend)(U().prototype,"view",(function(e){var n=0,a=t.forum.attribute("malago-achievements.show-user-card"),i=m("div.UserCard-Achievement-list");if("1"===a&&e.attrs.className.includes("UserCard--popover")){var s=this.attrs.user.achievements();null!=s&&(Object.keys(s).forEach((function(e){var t=s[e].data.attributes,a=t.rectangle.split(",");if(t.image.includes("http")){var o="background:url("+t.image+");              background-position:-"+a[0]+"px -"+a[1]+"px;              height:"+a[2]+"px;              width:"+a[3]+"px;              margin: -"+(a[3]/4-4)+"px;";i.children.push(m(j(),{text:t.name},m("span.Badge.Achievement",{style:o},"")))}else i.children.push(m(j(),{text:t.name},m("span.Badge.Achievement--Icon",m("i.icon."+t.image))));n+=t.points})),i.children.length>0&&n>0&&i.children.push(m(j(),{text:t.translator.trans("malago-achievements.forum.achievement_points")},m("span.Achievement--Points",t.translator.trans("malago-achievements.forum.achievement_points")+": ",m("span.Achievement--Points--Number",n)))),e.children.push(i))}})),(0,e.extend)(a().prototype,"view",(function(e){var n=0;"1"!=t.forum.attribute("malago-achievements.show-post-footer")||this.attrs.post.data.attributes.isHidden||(this.attrs.post.data.attributes.achievements.forEach((function(t,a){var i=t.rectangle.split(",");if(t.image.includes("http")){var s="background:url("+t.image+");            background-position:-"+i[0]+"px -"+i[1]+"px;            height:"+i[2]+"px;            width:"+i[3]+"px;            margin: -"+(i[3]/4-4)+"px;";e.children[0].children[2].children.push(m(j(),{text:t.name},m("span.Badge.Achievement",{style:s},"")))}else e.children[0].children[2].children.push(m(j(),{text:t.name},m("span.Badge.Achievement--Icon",m("i.icon."+t.image))));n+=t.points})),e.children[0].children[2].children.length>0&&n>0&&e.children[0].children[2].children.push(m(j(),{text:t.translator.trans("malago-achievements.forum.achievement_points")},m("span.Achievement--Points",t.translator.trans("malago-achievements.forum.achievement_points")+": ",m("span.Achievement--Points--Number",n)))))})),(0,e.extend)(s().prototype,"request",(function(e){e&&e.then((function(e){"string"==typeof e.new_achievements&&(e.new_achievements=JSON.parse(e.new_achievements)),e&&void 0!==e.new_achievements&&null!==e.new_achievements&&e.new_achievements.length>0&&t.modal.show(y,{achievements:e.new_achievements})}))})),(0,e.extend)(w().prototype,"oncreate",(function(e){t.session.user&&setTimeout((function(){var e=t.session.user.achievements();if((null==e?void 0:e.length)>0){var n=e.filter((function(e){return 1===e.data.attributes.new})).map((function(e){return e.save({new:0,user_id:t.session.user.data.id}),e.data.attributes}));n.length>0&&t.modal.show(y,{achievements:n})}}),1e3)}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map