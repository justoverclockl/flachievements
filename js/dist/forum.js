(()=>{var e={787:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var n=a(588),i=a(921),s=a.n(i),o=(a(779),function(e){function t(){return e.apply(this,arguments)||this}return(0,n.A)(t,e),t}(s()));Object.assign(o.prototype,{id:s().attribute("id"),name:s().attribute("name"),description:s().attribute("description"),computation:s().attribute("computation"),points:s().attribute("points"),rectangle:s().attribute("rectangle"),image:s().attribute("image"),new:s().attribute("new"),active:s().attribute("active"),hidden:s().attribute("hidden")})},556:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var n=a(588),i=a(921),s=a.n(i),o=function(e){function t(){return e.apply(this,arguments)||this}return(0,n.A)(t,e),t}(s());Object.assign(o.prototype,{achievement_id:s().attribute("achievement_id"),user_id:s().attribute("user_id"),new:s().attribute("new")})},506:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var n=a(921),i=a.n(n),s=a(524),o=a.n(s),r=a(787),c=a(556);function m(){o().prototype.achievements=i().hasMany("achievements","achievement_user"),o().prototype.achievement_user=i().hasMany("achievement_user"),app.store.models.achievements=r.A,app.store.models.achievement_user=c.A}},921:e=>{"use strict";e.exports=flarum.core.compat.Model},524:e=>{"use strict";e.exports=flarum.core.compat["models/User"]},779:e=>{"use strict";e.exports=flarum.core.compat["utils/mixin"]},588:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var n=a(47);function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(0,n.A)(e,t)}},47:(e,t,a)=>{"use strict";function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}a.d(t,{A:()=>n})}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";const e=flarum.core.compat.extend,t=flarum.core.compat["components/CommentPost"];var n=a.n(t);const i=flarum.core.compat["common/Application"];var s=a.n(i),o=a(588);const r=flarum.core.compat.app;var c=a.n(r);const l=flarum.core.compat["helpers/icon"];var p=a.n(l);const h=flarum.core.compat["components/Modal"];var u=a.n(h);const d=flarum.core.compat["utils/ItemList"];var v=a.n(d);const f=flarum.core.compat["components/Button"];var g=a.n(f),b=function(e){function t(){return e.apply(this,arguments)||this}(0,o.A)(t,e);var a=t.prototype;return a.title=function(){return c().translator.trans("malago-achievements.forum.new_achievement_title")},a.oninit=function(t){e.prototype.oninit.call(this,t)},a.fields=function(){for(var e=new(v()),t=0;t<this.attrs.achievements.length;t++){var a=this.attrs.achievements[t].rectangle.split(",");if(this.attrs.achievements[t].image.includes("http")){var n="background:url("+this.attrs.achievements[t].image+");                    background-position:-"+a[0]+"px -"+a[1]+"px;                    height:"+a[2]+"px;                    width:"+a[3]+"px;";e.add("image"+t,m("div",{className:"Form-group"},m("span",{class:"Badge Achievement",style:n})),-10)}else e.add("image"+t,m("div",{className:"Form-group"},m("span",{class:"Badge Achievement--Icon"},p()(this.attrs.achievements[t].image))),-10);e.add("name"+t,m("div",{className:"Form-group"},m("h1",null,this.attrs.achievements[t].name)),-10),e.add("description"+t,m("div",{className:"Form-group"},m("h3",null,this.attrs.achievements[t].description)),-10)}return e.add("close",m("div",{className:"NewAchievementModal--Button"},g().component({type:"button",className:"Button Button--primary",onclick:this.hide.bind(this)},c().translator.trans("malago-achievements.forum.new_achievement_close"))),-10),e},a.footer=function(){return null},a.content=function(){return this.loading?m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"container"},m(LoadingIndicator,null)))):m("div",{className:"Modal-body"},m("div",{className:"Modal--New-Achievement"},this.fields().toArray()))},t}(u());const _=flarum.core.compat["components/IndexPage"];var y=a.n(_);const A=flarum.core.compat["components/Page"];var x=a.n(A);const w=flarum.core.compat["common/components/Page"];var N=a.n(w);flarum.core.compat["components/Link"];const L=flarum.core.compat["components/LoadingIndicator"];var I=a.n(L);const O=flarum.core.compat["helpers/listItems"];var P=a.n(O);flarum.core.compat["helpers/humanTime"];const k=flarum.core.compat["components/Tooltip"];var B=a.n(k),M=function(e){function t(){return e.apply(this,arguments)||this}(0,o.A)(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;this.loading=!0,e.prototype.oninit.call(this,t),app.session.user||m.route.set("/"),this.achievements_ids=[],app.data.resources.map((function(e){"achievement_user"==e.type&&a.achievements_ids.push(e.attributes.id)})),this.achievements_all=[],this.html_user="",this.html_all="",this.points=0,this.hidden_count=0,app.store.find("achievements").then((function(e){a.achievements_all=e,a.achievements_all.map((function(e){var t=e.rectangle().split(","),n="";n=e.image().includes("http")?'<li>              <div class="AchievementsList-Item">                <div class="Badge Achievement" style="background:url('+e.image()+");            background-position:-"+t[0]+"px -"+t[1]+"px;            height:"+t[2]+"px;            width:"+t[3]+'px;" data-toggle="tooltip" title='+e.name()+'></div>                  <table class="AchievementsList-info"><tr><td class="AchievementsList-name">'+e.name()+'</td><td class="AchievementsList-points">'+app.translator.trans("malago-achievements.forum.achievement_points")+": "+e.points()+'</td></tr></table>                  <div class="AchievementsList-description">'+e.description()+"</div>              </div>            </li>":'<li>              <div class="AchievementsList-Item">                <div class="Badge Achievement--Icon"><i class="icon '+e.image()+'"></i></div>                <table class="AchievementsList-info"><tr><td class="AchievementsList-name">'+e.name()+'</td><td class="AchievementsList-points">'+app.translator.trans("malago-achievements.forum.achievement_points")+": "+e.points()+'</td></tr></table>                <div class="AchievementsList-description">'+e.description()+"</div>              </div>            </li>",-1!==a.achievements_ids.indexOf(parseInt(e.data.id))?(a.html_user+=n,a.points+=parseFloat(e.points())):0==e.hidden()?a.html_all+=n:a.hidden_count+=1})),a.loading=!1,m.redraw()}))},a.view=function(){return this.loading?m(I(),null):m("div",{className:"IndexPage"},y().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,P()(y().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h2",null,app.translator.trans("malago-achievements.forum.your_achievements")),m("div",{className:"AchievementsList"},m("ul",{className:"AchievementsList-achievements"},m.trust(this.html_user),m("li",null,m("div",{class:"AchievementsList-Item"},m("div",{className:"AchievementsList-points AchievementsList-total",style:"color: black; border: 2px solid black;"},app.translator.trans("malago-achievements.forum.achievement_total_points")+": "+this.points))))),m("h2",null,app.translator.trans("malago-achievements.forum.other_achievements")),m("div",{className:"AchievementsList AchievementsList-Other"},m("ul",{className:"AchievementsList-achievements"},m.trust(this.html_all))),m("div",{className:"AchievementsHidden"},this.hidden_count>0?app.translator.trans("malago-achievements.forum.hidden_achievements")+": "+this.hidden_count:"")))))},a.oncreate=function(t){e.prototype.oncreate.call(this,t),app.setTitle(app.translator.trans("malago-achievements.forum.list_heading")),app.setTitleCount(0)},t}(N());const j=flarum.core.compat["components/LinkButton"];var T=a.n(j);const C=flarum.core.compat["components/UserCard"];var F=a.n(C),S=a(506).default;app.initializers.add("malago-achievements",(function(t){t.routes.achievements={path:"/achievements",component:M},(0,e.extend)(y().prototype,"navItems",(function(e){var a=t.forum.attribute("malago-achievements.link-left-column");t.session.user&&1==a&&e.add("achievements",m(T(),{icon:"fas fa-trophy",href:t.route("achievements")},t.translator.trans("malago-achievements.forum.list_heading")),-11)})),S(),(0,e.extend)(F().prototype,"view",(function(e){var a=0,n=t.forum.attribute("malago-achievements.show-user-card"),i=m("div.UserCard-Achievement-list");if("1"==n&&e.attrs.className.includes("UserCard--popover")){var s=this.attrs.user.achievements();null!=s&&(Object.keys(s).forEach((function(e){var t=s[e].data.attributes,n=t.rectangle.split(",");if(t.image.includes("http")){var o="background:url("+t.image+");              background-position:-"+n[0]+"px -"+n[1]+"px;              height:"+n[2]+"px;              width:"+n[3]+"px;              margin: -"+(n[3]/4-4)+"px;";i.children.push(m(B(),{text:t.name},m("span.Badge.Achievement",{style:o},"")))}else i.children.push(m(B(),{text:t.name},m("span.Badge.Achievement--Icon",m("i.icon."+t.image))));a+=t.points})),i.children.length>0&&a>0&&i.children.push(m(B(),{text:t.translator.trans("malago-achievements.forum.achievement_points")},m("span.Achievement--Points",t.translator.trans("malago-achievements.forum.achievement_points")+": ",m("span.Achievement--Points--Number",a)))),e.children.push(i))}})),(0,e.extend)(n().prototype,"view",(function(e){var a=0;"1"!=t.forum.attribute("malago-achievements.show-post-footer")||this.attrs.post.data.attributes.isHidden||(this.attrs.post.data.attributes.achievements.forEach((function(t,n){var i=t.rectangle.split(",");if(t.image.includes("http")){var s="background:url("+t.image+");            background-position:-"+i[0]+"px -"+i[1]+"px;            height:"+i[2]+"px;            width:"+i[3]+"px;            margin: -"+(i[3]/4-4)+"px;";e.children[0].children[2].children.push(m(B(),{text:t.name},m("span.Badge.Achievement",{style:s},"")))}else e.children[0].children[2].children.push(m(B(),{text:t.name},m("span.Badge.Achievement--Icon",m("i.icon."+t.image))));a+=t.points})),e.children[0].children[2].children.length>0&&a>0&&e.children[0].children[2].children.push(m(B(),{text:t.translator.trans("malago-achievements.forum.achievement_points")},m("span.Achievement--Points",t.translator.trans("malago-achievements.forum.achievement_points")+": ",m("span.Achievement--Points--Number",a)))))})),(0,e.extend)(s().prototype,"request",(function(e){e&&e.then((function(e){"string"==typeof e.new_achievements&&(e.new_achievements=JSON.parse(e.new_achievements)),e&&void 0!==e.new_achievements&&null!==e.new_achievements&&e.new_achievements.length>0&&t.modal.show(b,{achievements:e.new_achievements})}))})),(0,e.extend)(x().prototype,"oncreate",(function(e){void 0!==t.session.user&&null!==t.session.user&&setTimeout((function(){var e=t.session.user.achievements();if(null!=e&&e.length>0){for(var a=[],n=0;n<e.length;n++)1==e[n].data.attributes.new&&(a.push(e[n].data.attributes),e[n].save({new:0,user_id:t.session.user.data.id}));a.length>0&&t.modal.show(b,{achievements:a})}}),1e3)}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map